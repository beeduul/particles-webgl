<!DOCTYPE html>
<html>
<head>
  <meta http-equiv="Content-type" content="text/html; charset=utf-8">
  <title>WebGL Particles</title>
</head>
<body id="index">
  <canvas id="glcanvas" width="640" height="480">
    Your browser doesn't appear to support the <code>&lt;canvas&gt;</code> element.
  </canvas>
  
  <script id="particle_sim_vs" type="x-shader/x-vertex">
  #ifdef GL_ES
  precision highp float;
  #endif

  attribute vec3 aPosition;

  void main() {
    gl_Position = vec4(aPosition, 1.0);
  }
  </script>
  
  <script id="particle_sim_fs" type="x-shader/x-fragment">
  #extension GL_EXT_draw_buffers : require

  precision mediump float;
  uniform vec2 uResolution;
  uniform sampler2D uTexture0; // x, y, ?, t
  uniform sampler2D uTexture1; // r, g, b, a
  uniform int uDeltaTime;

  void main() {
    vec2 uv = gl_FragCoord.xy / uResolution.xy;

    vec4 quartet = texture2D(uTexture0, uv);
    vec3 pos = quartet.rgb + vec3(0.001, 0.0, 0.0);
    float t = quartet.a - 0.01;

    gl_FragData[0] = vec4(pos, t);
  }
  </script>
  
  <script id='particle_vs' type="x-shader/x-vertex">
  // attribute vec2 vertexPosition;
  attribute vec2 aUV;
  varying vec3 vPosition;
  varying vec2 vUV;
  uniform sampler2D uTexture0; // x, y, ?, t
  uniform sampler2D uTexture1; // r, g, b, a
  
  vec2 uvToScreen(vec2 uv) {
    return uv * 2.0 - vec2(1.0, 1.0);
  }
  
  void main() {

    vec4 quartet = texture2D(uTexture0, aUV);
    vPosition = quartet.rgb;
    
    gl_PointSize = 3.0; // quartet.a;
    // gl_Position = vec4(uvToScreen(aUV), 1.0, 1.0);
    gl_Position = vec4(quartet.rgb, 1.0);
    
    vUV = aUV;
    // gl_Position = vec4(quartet.rgb, 1.0);

    // gl_Position = vec4(vertexPosition*2.0 - vec2(1.0, 1.0), 0.0, 1.0 );//converts to clip space
  }
  </script>
  
  <script id='particle_fs' type="x-shader/x-fragment">
  #ifdef GL_ES
  precision highp float;
  #endif

  varying vec3 vPosition;
  varying vec2 vUV;
  
  uniform sampler2D uTexture0; // x, y, ?, t
  uniform sampler2D uTexture1; // r, g, b, a
  uniform vec4 uColor;

  void main() {
    // gl_FragColor = uColor;
    vec4 particle = texture2D(uTexture0, vUV);
    
    vec4 color = texture2D(uTexture1, vUV);
    
    float t = particle.a;
    vec3 simColor = uColor.rgb * t;
    if (t <= 0.0) {
      discard;
    }
    gl_FragColor = vec4(simColor, 1.0);
  }
  </script>
  
  <script src="app.js"></script>
  <script>require('app').init();</script>
  
</body>
</html>